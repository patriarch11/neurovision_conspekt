Згорткова нейронна мережа (convolutional neural network, CNN) - це тип нейронної мережі, який спеціально розроблений для обробки даних, що мають сітчасту структуру, таких як зображення.
Основною ідеєю згорткових нейронних мереж є використання згорткових шарів, які здатні автоматично виділяти важливі особливості з вхідних даних.

### Основні поняття

1. **Згортка (Convolution):**
Згортка - це операція, яка застосовує фільтр (ядро) до вхідного зображення, щоб створити карту ознак (feature map).
Фільтр ковзає (або згорткається) по зображенню, виконуючи операцію згортки для кожного його підрозділу.
Це допомагає виділяти такі особливості, як контури, кути, текстури тощо.

2. ***Фільтр (ядро, kernel):**
Фільтр - це невелика матриця чисел, яка застосовується до вхідних даних.
Наприклад, фільтр розміром 3x3 ковзає по зображенню і виконує згортку для кожного підрозділу розміром 3x3.
Кількість фільтрів у шарі визначає кількість вихідних карт ознак.

3. **Підвибірка (Pooling):**
Після згортки часто застосовується підвибірка (наприклад, максимальне або середнє підвибіркування), яка зменшує розмір карти ознак, зберігаючи найважливішу інформацію.
Це допомагає зменшити обчислювальні витрати та запобігти перенавчанню.

4. **Розріджені зв'язки (Sparsity of connections):**
Згорткові шари не мають повних зв'язків між нейронами, як це є в традиційних повнозв'язних шарах.
Замість цього кожен нейрон у згортковому шарі з'єднаний тільки з невеликою локальною областю попереднього шару.
Це зменшує кількість параметрів і підвищує ефективність.

5. **Поділ параметрів (Parameter sharing):**
Один і той самий фільтр застосовується до всього зображення, що означає, що параметри фільтра (ваги) поділяються між всіма нейронами шару.
Це зменшує кількість параметрів і дозволяє моделі бути більш стійкою до зсувів і трансляцій у вхідних даних.

### Приклад згорткової операції
Розглянемо простий приклад згорткової операції з ядром розміром 3x3 та вхідним зображенням розміром 5x5:

**Вхідне зображення:**

```
[ [1, 2, 3, 0, 1],
  [4, 5, 6, 1, 2],
  [7, 8, 9, 2, 3],
  [0, 1, 2, 3, 4],
  [1, 2, 3, 4, 5] ]
```


**Фільтр (ядро):**

```
[ [1, 0, -1],
  [1, 0, -1],
  [1, 0, -1] ]
```

**Результат згорткової операції (карта ознак):**

```
[[-6. 12. 12.]
 [-6.  8.  8.]
 [-6.  2.  2.]]
```

Як бачите, результат згорткової операції - це зменшене зображення, що містить виділені особливості вхідного зображення.

### Застосування

Згорткові нейронні мережі широко використовуються в задачах комп'ютерного зору,
таких як розпізнавання об'єктів, класифікація зображень, сегментація зображень, розпізнавання рукописного тексту тощо.

## Згортка 

- (convolution) є основною математичною операцією, яка застосовується фільтром до рядка або будь-якої іншої частини вхідних даних. Давайте розглянемо, як це працює на практичному прикладі з одновимірними даними.

Одновимірна згортка
Вхідні дані (рядок)
```
[1, 2, 3, 4, 5]
```
Фільтр (ядро)

```
[1, 0, -1]
```

Процес згортки
Для застосування фільтра до вхідного рядка ми виконуємо наступні кроки:

Вибираємо частину вхідних даних, яка відповідає розміру фільтра.
Множимо кожен елемент цієї частини на відповідний елемент фільтра.
Сумуємо результати множення.
Записуємо суму як елемент вихідного ряду.
Зсуваємо фільтр на одну позицію і повторюємо кроки 1-4.
Приклад
Крок 1: Позиція 1

```
Вхід:  [1, 2, 3, 4, 5]
Фільтр:  [1, 0, -1]
```
Множимо і сумуємо:

```
(1 * 1) + (2 * 0) + (3 * -1) = 1 + 0 - 3 = -2
```

Крок 2: Позиція 2
```
Вхід:  [1, 2, 3, 4, 5]
Фільтр:     [1, 0, -1]
```
Множимо і сумуємо:

```
(2 * 1) + (3 * 0) + (4 * -1) = 2 + 0 - 4 = -2
```

Крок 3: Позиція 3
```
Вхід:  [1, 2, 3, 4, 5]
Фільтр:        [1, 0, -1]
```
Множимо і сумуємо:

```
(3 * 1) + (4 * 0) + (5 * -1) = 3 + 0 - 5 = -2
```
В результаті вихідний рядок після застосування згортки з фільтром:

```
[-2, -2, -2]
```



#### Двовимірна згортка
Для зображень використовується двовимірна згортка, яка є узагальненням одновимірної операції на двовимірні матриці. Вона працює аналогічним чином:

Фільтр ковзає по вхідному зображенню.
На кожній позиції множиться кожен елемент області зображення на відповідний елемент фільтра.
Сумуються результати множення.
Ця сума стає елементом вихідної карти ознак.
Ось приклад коду для 2D згортки в PyTorch:

```python
import torch
import torch.nn.functional as F

# Вхідне зображення 5x5

input = torch.tensor([[1, 2, 3, 0, 1],
                      [4, 5, 6, 1, 2],
                      [7, 8, 9, 2, 3],
                      [0, 1, 2, 3, 4],
                      [1, 2, 3, 4, 5]], dtype=torch.float32).unsqueeze(0).unsqueeze(0)

# Фільтр (ядро) 3x3
kernel = torch.tensor([[1, 0, -1],
                       [1, 0, -1],
                       [1, 0, -1]], dtype=torch.float32).unsqueeze(0).unsqueeze(0)

# Застосування згортки
output = F.conv2d(input, kernel, stride=1, padding=0)

print(output)
```

Цей приклад коду застосовує 2D згортку до вхідного зображення з фільтром 3x3 і виводить результуючу карту ознак.

